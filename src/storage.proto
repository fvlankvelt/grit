//syntax = "proto3";
edition = "2023";

package storage;

// In-progress snapshots are persisted for snapshot isolation and time-travel
// Each InProgress corresponds to a txId
message InProgress {
    // last readable data at this txId
    uint64 logIdx = 1;
    repeated uint64 txIds = 2;
}

// Committed transactions are written so that conficts can be detected with to-be-committed transactions.
message Transaction {
    repeated bytes touched = 1;
}

message TransactionOperation {
    uint64 txId = 1;
    oneof op {
        bytes touched = 2;
    }
}

message TransactionManagerState {
    uint64 lastTxId = 1;
    repeated uint64 committed = 2;
    repeated uint64 invalid = 4;
}

enum ItemAction {
    DELETE = 0;
    PUT = 1;
}

message ItemOperation {
    uint64 txId = 1;
    ItemAction action = 2;
}

message ItemState {
    ItemAction action = 1;
    uint32 numOperands = 2;
    uint32 numInvalid = 3;
    repeated uint64 putsInProgress = 4;
    repeated uint64 deletesInProgress = 5;
}